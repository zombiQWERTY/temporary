{
  "$schema": "https://www.krakend.io/schema/krakend.json",
  "version": 3,
  "name": "KrakenD API Gateway for ERPModul",
  "timeout": "30s",
  "echo_endpoint": true,
  "endpoints": [
    {{ template "auth.tmpl" . }},

    {{ template "alert_story.tmpl" . }},
    {{ template "users_story.tmpl" . }},
    {{ template "meta_story.tmpl" . }},
    {{ template "branches_story.tmpl" . }},
    {{ template "files_story.tmpl" . }},
    {{ template "accounts_story.tmpl" . }},
    {{ template "accounts_settings_story.tmpl" . }},
    {{ template "accounts_rates_story.tmpl" . }},
    {{ template "products_tm_story.tmpl" . }}
  ],
  "extra_config": {
    {{ include "extra_config.tmpl" }},
    "telemetry/metrics": {
      "collection_time": "30s",
      "listen_address": ":8090"
    },
    "security/cors": {
      {{- $corsAllowedOrigins := splitList "," (env "CORS_ALLOWED_ORIGINS") -}}
      "allow_origins": [
        {{- range $index, $origin := $corsAllowedOrigins }}
          "{{ $origin }}"{{ if lt (add $index 1) (len $corsAllowedOrigins) }},{{ end }}
        {{- end }}
      ],
      "allow_credentials": true,
      "allow_methods": ["POST", "GET", "PATCH", "PUT"],
      "allow_headers": ["Origin", "Authorization", "Content-Type", "Cache-Control", "Pragma", "Accept-Language"],
      "expose_headers": ["Content-Length"],
      "max_age": "12h"
    }
  }
}
